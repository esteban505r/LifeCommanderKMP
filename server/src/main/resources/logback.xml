<configuration>
    <variable name="LOG_LEVEL" value="${env:LOG_LEVEL:-DEBUG}"/>
    <variable name="ENVIRONMENT" value="${env:ENVIRONMENT:-production}"/>
    <variable name="RELEASE" value="${env:GIT_COMMIT:-unknown}"/>
    <variable name="SENTRY_DSN" value="${env:SENTRY_DSN:-}"/>

    <timestamp key="tz" datePattern="Z"/>

    <appender name="CONSOLE" class="ch.qos.logback.core.ConsoleAppender">
        <encoder>
            <!-- ISO8601 in UTC, level, logger, message, MDC(requestId, userId, traceId) -->
            <pattern>%d{yyyy-MM-dd'T'HH:mm:ss.SSS'Z',UTC} %-5level %logger - %msg | req=%X{requestId} user=%X{userId} trace=%X{traceId}%n</pattern>
        </encoder>
    </appender>

    <root level="${LOG_LEVEL}">
        <appender-ref ref="CONSOLE"/>
    </root>

    <!-- Add specific loggers for Flyway and PostgreSQL -->
    <logger name="org.flywaydb" level="DEBUG"/>
    <logger name="org.postgresql" level="DEBUG"/>
    <logger name="com.esteban.ruano" level="DEBUG"/>  <!-- Your app's package -->

    <!-- Quiet common chatter -->
    <logger name="io.netty" level="WARN"/>
    <logger name="org.apache" level="WARN"/>
    <logger name="org.eclipse.jetty" level="WARN"/>
    <logger name="ktor.application" level="DEBUG"/>
</configuration>
