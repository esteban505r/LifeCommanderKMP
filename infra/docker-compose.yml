services:
  nginx:
    image: nginx:1.27-alpine
    # no static container_name (avoid collisions)
    ports: ["80:80", "443:443"]
    volumes:
      - ./nginx.conf:/etc/nginx/conf.d/default.conf:ro
      - ./certbot/conf:/etc/letsencrypt
      - ./certbot/www:/var/www/certbot
    depends_on:
      oter:
        condition: service_started   # don't block on health for now
    restart: always
    networks: [edge]

  oter:
    image: ${IMAGE_REPO}:${IMAGE_TAG}
    environment:
      PORT: "8080"
      LOG_LEVEL: INFO
      AWS_REGION: us-east-1
      # TEMP: comment this if the file doesn't exist in your image
      # JAVA_TOOL_OPTIONS: "-Dlogback.configurationFile=/app/logback.xml"
      # If needed for your framework, add:
      # HOST: "0.0.0.0"
    expose: ["8080"]
    restart: unless-stopped
    networks: [edge]

networks:
  edge:
    external: true
